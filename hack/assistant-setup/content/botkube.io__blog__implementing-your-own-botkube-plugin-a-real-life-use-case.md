Title: Implementing Your Own Botkube Plugin - Keptn Use Case

URL Source: https://botkube.io/blog/implementing-your-own-botkube-plugin-a-real-life-use-case

Published Time: May 24, 2023

Markdown Content:
![Image 1](https://assets-global.website-files.com/634fabb21508d6c9db9bc46f/636df3f055589d08e3e7a3c4_w4WfaGM6LbgXbKSciuiiWfHDQQIN8gQVL0IxF369W1k.jpeg)

Huseyin Babal

Cloud Engineer

Botkube

Botkube has plugin system that allows you to extend the functionalities of Botkube core to satisfy your requirements. Here is a real-life example using Keptn.

### Table of Contents

*   [Background](#background)
*   [Keptn Installation](#keptn-installation)
*   [Accessing Keptn Gateway](#accessing-keptn-gateway)
*   [Keptn CLI](#keptn-cli)
*   [Create Keptn Project](#create-keptn-project)
*   [Create Keptn Service with Resource](#create-keptn-service-with-resource)
*   [Trigger Keptn Sequence](#trigger-keptn-sequence)
*   [Accessing API](#accessing-api)
*   [Plugin Development](#plugin-development)
*   [Plugin Configuration Structure](#plugin-configuration-structure)
*   [Simple Keptn Client Implementation](#simple-keptn-client-implementation)
*   [Keptn Plugin Core](#keptn-plugin-core)
*   [Building Plugin](#building-plugin)
*   [Running Botkube](#running-botkube)
*   [Get Started with Botkube Plugin Development](#get-started-with-botkube-plugin-development)

#### Start Using Botkube AI Assistant Today!

[Botkube's plugin system](https://botkube.io/blog/beginners-guide-to-botkube-plugin-development-how-botkube-plug-ins-can-unify-your-cloud-native-tools) allows users to extend the functionalities of Botkube core to enhance the capabilities of cloud native tools already in their tool belt. Whether you're using some of our pre-built plugins like [Helm](https://botkube.io/integration/helm) or [Prometheus](https://botkube.io/integration/prometheus), or want to use tools like Flux, Thanos, or any others on the CNCF landscape, the plugin system will help you and your team with collaborative troubleshooting instantly through your favorite messaging platform.

So let's dive in!

In this article, we will implement a Botkube plugin to integrate it with [Keptn,](https://botkube.io/integration/keptn) a cloud-native application lifecycle management tool for kubernetes. Use this as a starting point for your own creation!

Background
----------

Before starting Keptn plugin implementation, let's take a look what it is and what kind of use-case it solves for us. Assume that you have CD flow that ships your features to live environment whenever you merge that specific feature into main branch. You might want to do a couple of checks before deployment, and Keptn is good for that kind of verifications. You can do a load test with [k6](https://k6.io/), an open source load testing tool, by using in Keptn to do load test and verify results. However, to make it simpler to understand how Keptn works and how to integrate it with Botkube, we will be deploying a simple task with Keptn and consume Keptn events with Botkube to receive notifications in communication platform like Slack.

Keptn Installation
------------------

You can easily deploy keptn via Helm Chart with the following command.

To execute a task in Keptn environment, we can use a Keptn integration which is 'Job Executor Service'. This will help us to execute task based on our configuration. You can deploy executor service as shown below.

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="Shell" data-tagsearch-path="keptn_task_executor_helm_chart_installation.sh"><tbody><tr><td id="file-keptn_task_executor_helm_chart_installation-sh-L1" data-line-number="1"></td><td id="file-keptn_task_executor_helm_chart_installation-sh-LC1"><span>export</span> JES_VERSION=0.3.0</td></tr><tr><td id="file-keptn_task_executor_helm_chart_installation-sh-L2" data-line-number="2"></td><td id="file-keptn_task_executor_helm_chart_installation-sh-LC2"><span>export</span> TASK_SUBSCRIPTION=<span><span>"</span>sh.keptn.event.remote-task.triggered<span>"</span></span></td></tr><tr><td id="file-keptn_task_executor_helm_chart_installation-sh-L3" data-line-number="3"></td><td id="file-keptn_task_executor_helm_chart_installation-sh-LC3">helm upgrade --install --create-namespace -n keptn-jes job-executor-service \</td></tr><tr><td id="file-keptn_task_executor_helm_chart_installation-sh-L4" data-line-number="4"></td><td id="file-keptn_task_executor_helm_chart_installation-sh-LC4">https://github.com/keptn-contrib/job-executor-service/releases/download/<span>${JES_VERSION}</span>/job-executor-service-<span>${JES_VERSION}</span>.tgz \</td></tr><tr><td id="file-keptn_task_executor_helm_chart_installation-sh-L5" data-line-number="5"></td><td id="file-keptn_task_executor_helm_chart_installation-sh-LC5">--set remoteControlPlane.autoDetect.enabled=<span><span>"</span>true<span>"</span></span> <span>\</span></td></tr><tr><td id="file-keptn_task_executor_helm_chart_installation-sh-L6" data-line-number="6"></td><td id="file-keptn_task_executor_helm_chart_installation-sh-LC6">--set subscription.pubsubTopic=<span>${TASK_SUBSCRIPTION}</span></td></tr></tbody></table>

‍ Keptn produces lots of events during the lifecycle management, but notice we are only interested in the event type `sh.keptn.event.remote-task.triggered`. Since, we deploy job executor service in same Kubernetes cluster, it will automatically find Keptn gateway with the flag `remoteControlPlane.autoDetect.enabled="true"`

Accessing Keptn Gateway
-----------------------

You can visit http://localhost:8080 to access Keptn Gateway by providing user and password which we extracted before.

Keptn CLI
---------

While you can handle everything in Keptn Gateway Dashboard, it would be beneficial to use Keptn CLI to handle things faster. You can install Keptn CLI with following command.

In order to access Keptn Gateway, you need to authenticate Keptn CLI with following command.

‍ You can copy this command from Keptn Gateway Dashboard under User icon in top right corner.

![Image 2](https://assets-global.website-files.com/634fabb21508d6c9db9bc46f/646b71df0ddcf082e6d025ff_keptn-user-icon.png)

![Image 3](https://assets-global.website-files.com/634fabb21508d6c9db9bc46f/646b72186e9e4352b281394a_keptn-auth-command-copy.png)

Now we are ready to create resources in Keptn.

‍

Create Keptn Project
--------------------

In Keptn, everything starts with Project where you basically define your Keptn resources. Keptn projects works with Git Upstream that you can also create one as shown below.

‍ `$GITHUB_USERNAME` and `$GITHUB_TOKEN` is used by Keptn to maintain its state in remote repository which is defined by empty `$GITHUB_REPO`. `--shipyard` parameter is used to defined project stages each deployment should go through until production stage. You can see an example shipyard file as follows.

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="YAML" data-tagsearch-path="keptn_shipyard.yaml"><tbody><tr><td id="file-keptn_shipyard-yaml-L1" data-line-number="1"></td><td id="file-keptn_shipyard-yaml-LC1"><span>apiVersion</span>: <span><span>"</span>spec.keptn.sh/0.2.4<span>"</span></span></td></tr><tr><td id="file-keptn_shipyard-yaml-L2" data-line-number="2"></td><td id="file-keptn_shipyard-yaml-LC2"><span>kind</span>: <span><span>"</span>Shipyard<span>"</span></span></td></tr><tr><td id="file-keptn_shipyard-yaml-L3" data-line-number="3"></td><td id="file-keptn_shipyard-yaml-LC3"><span>metadata</span>:</td></tr><tr><td id="file-keptn_shipyard-yaml-L4" data-line-number="4"></td><td id="file-keptn_shipyard-yaml-LC4"><span>name</span>: <span><span>"</span>botkube<span>"</span></span></td></tr><tr><td id="file-keptn_shipyard-yaml-L5" data-line-number="5"></td><td id="file-keptn_shipyard-yaml-LC5"><span>spec</span>:</td></tr><tr><td id="file-keptn_shipyard-yaml-L6" data-line-number="6"></td><td id="file-keptn_shipyard-yaml-LC6"><span>stages</span>:</td></tr><tr><td id="file-keptn_shipyard-yaml-L7" data-line-number="7"></td><td id="file-keptn_shipyard-yaml-LC7">- <span>name</span>: <span><span>"</span>production<span>"</span></span></td></tr><tr><td id="file-keptn_shipyard-yaml-L8" data-line-number="8"></td><td id="file-keptn_shipyard-yaml-LC8"><span>sequences</span>:</td></tr><tr><td id="file-keptn_shipyard-yaml-L9" data-line-number="9"></td><td id="file-keptn_shipyard-yaml-LC9">- <span>name</span>: <span><span>"</span>botkube-seq<span>"</span></span></td></tr><tr><td id="file-keptn_shipyard-yaml-L10" data-line-number="10"></td><td id="file-keptn_shipyard-yaml-LC10"><span>tasks</span>:</td></tr><tr><td id="file-keptn_shipyard-yaml-L11" data-line-number="11"></td><td id="file-keptn_shipyard-yaml-LC11">- <span>name</span>: <span><span>"</span>remote-task<span>"</span></span></td></tr></tbody></table>

‍ We have only one stage `production` and it contains a task which is named as `remote-task`. Now that we defined our project, let's continue with creating a service as follows.

Create Keptn Service with Resource
----------------------------------

‍ Above command simply creates a `hello` service under `botkube` project. Next step is to add resources to this service, for example a job definition as you can also see below.

‍ We added job config to `hello` service for `production` stage under `botkube` project. Also, you can see the content of `jobconfig.yaml` below.

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="YAML" data-tagsearch-path="keptn_job_config.yaml"><tbody><tr><td id="file-keptn_job_config-yaml-L1" data-line-number="1"></td><td id="file-keptn_job_config-yaml-LC1"><span>apiVersion</span>: <span>v2</span></td></tr><tr><td id="file-keptn_job_config-yaml-L2" data-line-number="2"></td><td id="file-keptn_job_config-yaml-LC2"><span>actions</span>:</td></tr><tr><td id="file-keptn_job_config-yaml-L3" data-line-number="3"></td><td id="file-keptn_job_config-yaml-LC3">- <span>name</span>: <span><span>"</span>Hello, Botkuber!<span>"</span></span></td></tr><tr><td id="file-keptn_job_config-yaml-L4" data-line-number="4"></td><td id="file-keptn_job_config-yaml-LC4"><span>events</span>:</td></tr><tr><td id="file-keptn_job_config-yaml-L5" data-line-number="5"></td><td id="file-keptn_job_config-yaml-LC5">- <span>name</span>: <span><span>"</span>sh.keptn.event.remote-task.triggered<span>"</span></span></td></tr><tr><td id="file-keptn_job_config-yaml-L6" data-line-number="6"></td><td id="file-keptn_job_config-yaml-LC6"><span>tasks</span>:</td></tr><tr><td id="file-keptn_job_config-yaml-L7" data-line-number="7"></td><td id="file-keptn_job_config-yaml-LC7">- <span>name</span>: <span><span>"</span>Say Hello<span>"</span></span></td></tr><tr><td id="file-keptn_job_config-yaml-L8" data-line-number="8"></td><td id="file-keptn_job_config-yaml-LC8"><span>image</span>: <span><span>"</span>alpine<span>"</span></span></td></tr><tr><td id="file-keptn_job_config-yaml-L9" data-line-number="9"></td><td id="file-keptn_job_config-yaml-LC9"><span>cmd</span>:</td></tr><tr><td id="file-keptn_job_config-yaml-L10" data-line-number="10"></td><td id="file-keptn_job_config-yaml-LC10">- <span>echo</span></td></tr><tr><td id="file-keptn_job_config-yaml-L11" data-line-number="11"></td><td id="file-keptn_job_config-yaml-LC11"><span>args</span>:</td></tr><tr><td id="file-keptn_job_config-yaml-L12" data-line-number="12"></td><td id="file-keptn_job_config-yaml-LC12">- <span><span>"</span>Hello World<span>"</span></span></td></tr></tbody></table>

‍ As you can also understand, it simply provisions a task by using `alpine` image to print `Hello World`. Once the task is started, it will produce an event `sh.keptn.event.remote-task.triggered`. This event is the one our job executor service interested in.

Trigger Keptn Sequence
----------------------

We have all the resources ready and now we can trigger a sequence to deploy remote task to see the response with following command.

‍ You will see the result of the command, but to see everything in detail, you can navigate to Keptn Gateway and see Sequences as follows.

![Image 4](https://assets-global.website-files.com/634fabb21508d6c9db9bc46f/646b723533b33f4cb5e03c8a_keptn-sequence.png)

Now that we understand how to trigger a sequence in Keptn, let's take a look how to access its API to consume events to integrate with Botkube.

Accessing API
-------------

You can navigate to http://localhost:8080/api to see Swagger Documentation of Keptn APIs. It contains multiple modules, and to receive events, we can select `mongodb-datastore` from the dropdown.

![Image 5](https://assets-global.website-files.com/634fabb21508d6c9db9bc46f/646b724ccd77eb686625a42e_swagger-docs.png)

Notice we already authorized Keptn CLI in previous sections, and we can reuse the token inside `keptn auth ...` command to use in Swagger Authorize to call endpoints in Swagger UI or construct following curl command.

‍ Now we have all of the requirements ready to be used in Botkube plugin development, let's continue with our fresh new plugin, Botkube Keptn Plugin!

Plugin Development
------------------

Before implementing Keptn plugin business logic, I would like provide 2 source for plugin development:

*   [Botkube Plugin Development Quick Start](https://docs.botkube.io/plugin/quick-start)
*   [Implementing Custom Botkube Source Plugin](https://docs.botkube.io/plugin/custom-source)

‍ Now we are ready to implement actual business logic of the Keptn plugin to receive events. You will see partial examples of the codebase in this article, but don't worry, you can see the full codebase here.

Plugin Configuration Structure
------------------------------

In order to integrate Botkube with Keptn, Botkube should now be the entrypoint of Keptn to consume events. Also, it needs a token for successful authentication with Keptn. Additionally, we can add filtering parameters like project and service to consume events for certain project and service. With those information, following Go struct can be used for plugin configuration.

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="Go" data-tagsearch-path="keptn_config.go"><tbody><tr><td id="file-keptn_config-go-L1" data-line-number="1"></td><td id="file-keptn_config-go-LC1"><span>// config.go</span></td></tr><tr><td id="file-keptn_config-go-L2" data-line-number="2"></td><td id="file-keptn_config-go-LC2"><span>package</span> keptn</td></tr><tr><td id="file-keptn_config-go-L3" data-line-number="3"></td><td id="file-keptn_config-go-LC3"><span>...</span></td></tr><tr><td id="file-keptn_config-go-L4" data-line-number="4"></td><td id="file-keptn_config-go-LC4"><span>// Config prometheus configuration</span></td></tr><tr><td id="file-keptn_config-go-L5" data-line-number="5"></td><td id="file-keptn_config-go-LC5"><span>type</span> <span>Config</span> <span>struct</span> {</td></tr><tr><td id="file-keptn_config-go-L6" data-line-number="6"></td><td id="file-keptn_config-go-LC6"><span>URL</span> <span>string</span> <span>`yaml:"url,omitempty"`</span></td></tr><tr><td id="file-keptn_config-go-L7" data-line-number="7"></td><td id="file-keptn_config-go-LC7"><span>Token</span> <span>string</span> <span>`yaml:"token,omitempty"`</span></td></tr><tr><td id="file-keptn_config-go-L8" data-line-number="8"></td><td id="file-keptn_config-go-LC8"><span>Project</span> <span>string</span> <span>`yaml:"project,omitempty"`</span></td></tr><tr><td id="file-keptn_config-go-L9" data-line-number="9"></td><td id="file-keptn_config-go-LC9"><span>Service</span> <span>string</span> <span>`yaml:"service,omitempty"`</span></td></tr><tr><td id="file-keptn_config-go-L10" data-line-number="10"></td><td id="file-keptn_config-go-LC10"><span>Log</span> config.<span>Logger</span> <span>`yaml:"log,omitempty"`</span></td></tr><tr><td id="file-keptn_config-go-L11" data-line-number="11"></td><td id="file-keptn_config-go-LC11">}</td></tr><tr><td id="file-keptn_config-go-L12" data-line-number="12"></td><td id="file-keptn_config-go-LC12"><span>...</span></td></tr></tbody></table>

‍ To have a smooth plugin integration, we can have configuration defaults, and once end user provides their own configuration, we should merge those configs as follows.

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="Go" data-tagsearch-path="keptn_initialize_config.go"><tbody><tr><td id="file-keptn_initialize_config-go-L1" data-line-number="1"></td><td id="file-keptn_initialize_config-go-LC1"><span>// config.go</span></td></tr><tr><td id="file-keptn_initialize_config-go-L2" data-line-number="2"></td><td id="file-keptn_initialize_config-go-LC2"><span>package</span> keptn</td></tr><tr><td id="file-keptn_initialize_config-go-L3" data-line-number="3"></td><td id="file-keptn_initialize_config-go-LC3"><span>import</span> <span>"github.com/kubeshop/botkube/pkg/pluginx"</span></td></tr><tr><td id="file-keptn_initialize_config-go-L4" data-line-number="4"></td><td id="file-keptn_initialize_config-go-LC4"><span>...</span></td></tr><tr><td id="file-keptn_initialize_config-go-L5" data-line-number="5"></td><td id="file-keptn_initialize_config-go-LC5"><span>// MergeConfigs merges all input configuration.</span></td></tr><tr><td id="file-keptn_initialize_config-go-L6" data-line-number="6"></td><td id="file-keptn_initialize_config-go-LC6"><span>func</span> <span>MergeConfigs</span>(<span>configs</span> []<span>*</span>source.<span>Config</span>) (<span>Config</span>, <span>error</span>) {</td></tr><tr><td id="file-keptn_initialize_config-go-L7" data-line-number="7"></td><td id="file-keptn_initialize_config-go-LC7"><span>defaults</span> <span>:=</span> <span>Config</span>{}</td></tr><tr><td id="file-keptn_initialize_config-go-L8" data-line-number="8"></td><td id="file-keptn_initialize_config-go-LC8"><span>var</span> <span>out</span> <span>Config</span></td></tr><tr><td id="file-keptn_initialize_config-go-L9" data-line-number="9"></td><td id="file-keptn_initialize_config-go-LC9"><span>// You can see useful utility packages like `pluginx` in Botkube core.</span></td></tr><tr><td id="file-keptn_initialize_config-go-L10" data-line-number="10"></td><td id="file-keptn_initialize_config-go-LC10"><span>if</span> <span>err</span> <span>:=</span> <span>pluginx</span>.<span>MergeSourceConfigsWithDefaults</span>(<span>defaults</span>, <span>configs</span>, <span>&amp;</span><span>out</span>); <span>err</span> <span>!=</span> <span>nil</span> {</td></tr><tr><td id="file-keptn_initialize_config-go-L11" data-line-number="11"></td><td id="file-keptn_initialize_config-go-LC11"><span>return</span> <span>Config</span>{}, <span>fmt</span>.<span>Errorf</span>(<span>"while merging configuration: %w"</span>, <span>err</span>)</td></tr><tr><td id="file-keptn_initialize_config-go-L12" data-line-number="12"></td><td id="file-keptn_initialize_config-go-LC12">}</td></tr><tr><td id="file-keptn_initialize_config-go-L13" data-line-number="13"></td><td id="file-keptn_initialize_config-go-LC13"><span>return</span> <span>out</span>, <span>nil</span></td></tr><tr><td id="file-keptn_initialize_config-go-L14" data-line-number="14"></td><td id="file-keptn_initialize_config-go-LC14">}</td></tr><tr><td id="file-keptn_initialize_config-go-L15" data-line-number="15"></td><td id="file-keptn_initialize_config-go-LC15"><span>...</span></td></tr></tbody></table>

‍

Simple Keptn Client Implementation
----------------------------------

We will implement an SDK to connect Keptn API to consume events. This will be a facade to reduce complexity and coupling. Keptn already has a [Go SDK](https://botkube.io/blog/github.com/keptn/go-utils/pkg/api/utils/v2), and in our client we will initialize an instance of that client and call events endpoint as shown below.

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="Go" data-tagsearch-path="keptn_client_implementation.go"><tbody><tr><td id="file-keptn_client_implementation-go-L1" data-line-number="1"></td><td id="file-keptn_client_implementation-go-LC1"><span>// client.go</span></td></tr><tr><td id="file-keptn_client_implementation-go-L2" data-line-number="2"></td><td id="file-keptn_client_implementation-go-LC2"><span>package</span> keptn</td></tr><tr><td id="file-keptn_client_implementation-go-L3" data-line-number="3"></td><td id="file-keptn_client_implementation-go-LC3"><span>import</span> (</td></tr><tr><td id="file-keptn_client_implementation-go-L4" data-line-number="4"></td><td id="file-keptn_client_implementation-go-LC4">api <span>"github.com/keptn/go-utils/pkg/api/utils/v2"</span></td></tr><tr><td id="file-keptn_client_implementation-go-L5" data-line-number="5"></td><td id="file-keptn_client_implementation-go-LC5"><span>"time"</span></td></tr><tr><td id="file-keptn_client_implementation-go-L6" data-line-number="6"></td><td id="file-keptn_client_implementation-go-LC6">)</td></tr><tr><td id="file-keptn_client_implementation-go-L7" data-line-number="7"></td><td id="file-keptn_client_implementation-go-LC7"><span>// Client Keptn client</span></td></tr><tr><td id="file-keptn_client_implementation-go-L8" data-line-number="8"></td><td id="file-keptn_client_implementation-go-LC8"><span>type</span> <span>Client</span> <span>struct</span> {</td></tr><tr><td id="file-keptn_client_implementation-go-L9" data-line-number="9"></td><td id="file-keptn_client_implementation-go-LC9"><span>// API refers to Keptn client. https://github.com/keptn/go-utils</span></td></tr><tr><td id="file-keptn_client_implementation-go-L10" data-line-number="10"></td><td id="file-keptn_client_implementation-go-LC10"><span>API</span> <span>*</span>api.<span>APISet</span></td></tr><tr><td id="file-keptn_client_implementation-go-L11" data-line-number="11"></td><td id="file-keptn_client_implementation-go-LC11">}</td></tr><tr><td id="file-keptn_client_implementation-go-L12" data-line-number="12"></td><td id="file-keptn_client_implementation-go-LC12"><span>type</span> <span>GetEventsRequest</span> <span>struct</span> {</td></tr><tr><td id="file-keptn_client_implementation-go-L13" data-line-number="13"></td><td id="file-keptn_client_implementation-go-LC13"><span>Project</span> <span>string</span></td></tr><tr><td id="file-keptn_client_implementation-go-L14" data-line-number="14"></td><td id="file-keptn_client_implementation-go-LC14"><span>FromTime</span> time.<span>Time</span></td></tr><tr><td id="file-keptn_client_implementation-go-L15" data-line-number="15"></td><td id="file-keptn_client_implementation-go-LC15">}</td></tr><tr><td id="file-keptn_client_implementation-go-L16" data-line-number="16"></td><td id="file-keptn_client_implementation-go-LC16"><span>type</span> <span>Event</span> <span>struct</span> {</td></tr><tr><td id="file-keptn_client_implementation-go-L17" data-line-number="17"></td><td id="file-keptn_client_implementation-go-LC17"><span>ID</span> <span>string</span></td></tr><tr><td id="file-keptn_client_implementation-go-L18" data-line-number="18"></td><td id="file-keptn_client_implementation-go-LC18"><span>Source</span> <span>string</span></td></tr><tr><td id="file-keptn_client_implementation-go-L19" data-line-number="19"></td><td id="file-keptn_client_implementation-go-LC19"><span>Type</span> <span>string</span></td></tr><tr><td id="file-keptn_client_implementation-go-L20" data-line-number="20"></td><td id="file-keptn_client_implementation-go-LC20"><span>Data</span> <span>Data</span></td></tr><tr><td id="file-keptn_client_implementation-go-L21" data-line-number="21"></td><td id="file-keptn_client_implementation-go-LC21">}</td></tr><tr><td id="file-keptn_client_implementation-go-L22" data-line-number="22"></td><td id="file-keptn_client_implementation-go-LC22"><span>type</span> <span>Data</span> <span>struct</span> {</td></tr><tr><td id="file-keptn_client_implementation-go-L23" data-line-number="23"></td><td id="file-keptn_client_implementation-go-LC23"><span>Message</span> <span>string</span></td></tr><tr><td id="file-keptn_client_implementation-go-L24" data-line-number="24"></td><td id="file-keptn_client_implementation-go-LC24"><span>Project</span> <span>string</span></td></tr><tr><td id="file-keptn_client_implementation-go-L25" data-line-number="25"></td><td id="file-keptn_client_implementation-go-LC25"><span>Service</span> <span>string</span></td></tr><tr><td id="file-keptn_client_implementation-go-L26" data-line-number="26"></td><td id="file-keptn_client_implementation-go-LC26"><span>Status</span> <span>string</span></td></tr><tr><td id="file-keptn_client_implementation-go-L27" data-line-number="27"></td><td id="file-keptn_client_implementation-go-LC27"><span>Stage</span> <span>string</span></td></tr><tr><td id="file-keptn_client_implementation-go-L28" data-line-number="28"></td><td id="file-keptn_client_implementation-go-LC28"><span>Result</span> <span>string</span></td></tr><tr><td id="file-keptn_client_implementation-go-L29" data-line-number="29"></td><td id="file-keptn_client_implementation-go-LC29">}</td></tr><tr><td id="file-keptn_client_implementation-go-L30" data-line-number="30"></td><td id="file-keptn_client_implementation-go-LC30"><span>...</span></td></tr><tr><td id="file-keptn_client_implementation-go-L31" data-line-number="31"></td><td id="file-keptn_client_implementation-go-LC31"><span>// NewClient initializes Keptn client</span></td></tr><tr><td id="file-keptn_client_implementation-go-L32" data-line-number="32"></td><td id="file-keptn_client_implementation-go-LC32"><span>func</span> <span>NewClient</span>(<span>url</span>, <span>token</span> <span>string</span>) (<span>*</span><span>Client</span>, <span>error</span>) {</td></tr><tr><td id="file-keptn_client_implementation-go-L33" data-line-number="33"></td><td id="file-keptn_client_implementation-go-LC33"><span>client</span>, <span>err</span> <span>:=</span> <span>api</span>.<span>New</span>(<span>url</span>, <span>api</span>.<span>WithAuthToken</span>(<span>token</span>))</td></tr><tr><td id="file-keptn_client_implementation-go-L34" data-line-number="34"></td><td id="file-keptn_client_implementation-go-LC34"><span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {</td></tr><tr><td id="file-keptn_client_implementation-go-L35" data-line-number="35"></td><td id="file-keptn_client_implementation-go-LC35"><span>return</span> <span>nil</span>, <span>err</span></td></tr><tr><td id="file-keptn_client_implementation-go-L36" data-line-number="36"></td><td id="file-keptn_client_implementation-go-LC36">}</td></tr><tr><td id="file-keptn_client_implementation-go-L37" data-line-number="37"></td><td id="file-keptn_client_implementation-go-LC37"><span>return</span> <span>&amp;</span><span>Client</span>{</td></tr><tr><td id="file-keptn_client_implementation-go-L38" data-line-number="38"></td><td id="file-keptn_client_implementation-go-LC38"><span>API</span>: <span>client</span>,</td></tr><tr><td id="file-keptn_client_implementation-go-L39" data-line-number="39"></td><td id="file-keptn_client_implementation-go-LC39">}, <span>nil</span></td></tr><tr><td id="file-keptn_client_implementation-go-L40" data-line-number="40"></td><td id="file-keptn_client_implementation-go-LC40">}</td></tr><tr><td id="file-keptn_client_implementation-go-L41" data-line-number="41"></td><td id="file-keptn_client_implementation-go-LC41"><span>// Events returns only new events.</span></td></tr><tr><td id="file-keptn_client_implementation-go-L42" data-line-number="42"></td><td id="file-keptn_client_implementation-go-LC42"><span>func</span> (<span>c</span> <span>*</span><span>Client</span>) <span>Events</span>(<span>ctx</span> context.<span>Context</span>, <span>request</span> <span>*</span><span>GetEventsRequest</span>) ([]<span>Event</span>, <span>error</span>) {</td></tr><tr><td id="file-keptn_client_implementation-go-L43" data-line-number="43"></td><td id="file-keptn_client_implementation-go-LC43"><span>fromTime</span> <span>:=</span> <span>request</span>.<span>FromTime</span>.<span>UTC</span>().<span>Format</span>(<span>time</span>.<span>RFC3339</span>)</td></tr><tr><td id="file-keptn_client_implementation-go-L44" data-line-number="44"></td><td id="file-keptn_client_implementation-go-LC44"><span>var</span> <span>events</span> []<span>Event</span></td></tr><tr><td id="file-keptn_client_implementation-go-L45" data-line-number="45"></td><td id="file-keptn_client_implementation-go-LC45"><span>res</span>, <span>err</span> <span>:=</span> <span>c</span>.<span>API</span>.<span>Events</span>().<span>GetEvents</span>(<span>ctx</span>, <span>&amp;</span>api.<span>EventFilter</span>{</td></tr><tr><td id="file-keptn_client_implementation-go-L46" data-line-number="46"></td><td id="file-keptn_client_implementation-go-LC46"><span>Project</span>: <span>request</span>.<span>Project</span>,</td></tr><tr><td id="file-keptn_client_implementation-go-L47" data-line-number="47"></td><td id="file-keptn_client_implementation-go-LC47"><span>FromTime</span>: <span>fromTime</span>,</td></tr><tr><td id="file-keptn_client_implementation-go-L48" data-line-number="48"></td><td id="file-keptn_client_implementation-go-LC48">}, api.<span>EventsGetEventsOptions</span>{})</td></tr><tr><td id="file-keptn_client_implementation-go-L49" data-line-number="49"></td><td id="file-keptn_client_implementation-go-LC49"><span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {</td></tr><tr><td id="file-keptn_client_implementation-go-L50" data-line-number="50"></td><td id="file-keptn_client_implementation-go-LC50"><span>return</span> <span>nil</span>, <span>err</span>.<span>ToError</span>()</td></tr><tr><td id="file-keptn_client_implementation-go-L51" data-line-number="51"></td><td id="file-keptn_client_implementation-go-LC51">}</td></tr><tr><td id="file-keptn_client_implementation-go-L52" data-line-number="52"></td><td id="file-keptn_client_implementation-go-LC52"><span>for</span> <span>_</span>, <span>ev</span> <span>:=</span> <span>range</span> <span>res</span> {</td></tr><tr><td id="file-keptn_client_implementation-go-L53" data-line-number="53"></td><td id="file-keptn_client_implementation-go-LC53"><span>data</span> <span>:=</span> <span>Data</span>{}</td></tr><tr><td id="file-keptn_client_implementation-go-L54" data-line-number="54"></td><td id="file-keptn_client_implementation-go-LC54"><span>err</span> <span>:=</span> <span>ev</span>.<span>DataAs</span>(<span>&amp;</span><span>data</span>)</td></tr><tr><td id="file-keptn_client_implementation-go-L55" data-line-number="55"></td><td id="file-keptn_client_implementation-go-LC55"><span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {</td></tr><tr><td id="file-keptn_client_implementation-go-L56" data-line-number="56"></td><td id="file-keptn_client_implementation-go-LC56"><span>return</span> <span>nil</span>, <span>err</span></td></tr><tr><td id="file-keptn_client_implementation-go-L57" data-line-number="57"></td><td id="file-keptn_client_implementation-go-LC57">}</td></tr><tr><td id="file-keptn_client_implementation-go-L58" data-line-number="58"></td><td id="file-keptn_client_implementation-go-LC58"><span>events</span> <span>=</span> <span>append</span>(<span>events</span>, <span>Event</span>{</td></tr><tr><td id="file-keptn_client_implementation-go-L59" data-line-number="59"></td><td id="file-keptn_client_implementation-go-LC59"><span>ID</span>: <span>ev</span>.<span>ID</span>,</td></tr><tr><td id="file-keptn_client_implementation-go-L60" data-line-number="60"></td><td id="file-keptn_client_implementation-go-LC60"><span>Source</span>: <span>*</span><span>ev</span>.<span>Source</span>,</td></tr><tr><td id="file-keptn_client_implementation-go-L61" data-line-number="61"></td><td id="file-keptn_client_implementation-go-LC61"><span>Type</span>: <span>*</span><span>ev</span>.<span>Type</span>,</td></tr><tr><td id="file-keptn_client_implementation-go-L62" data-line-number="62"></td><td id="file-keptn_client_implementation-go-LC62"><span>Data</span>: <span>data</span>,</td></tr><tr><td id="file-keptn_client_implementation-go-L63" data-line-number="63"></td><td id="file-keptn_client_implementation-go-LC63">})</td></tr><tr><td id="file-keptn_client_implementation-go-L64" data-line-number="64"></td><td id="file-keptn_client_implementation-go-LC64">}</td></tr><tr><td id="file-keptn_client_implementation-go-L65" data-line-number="65"></td><td id="file-keptn_client_implementation-go-LC65"><span>return</span> <span>events</span>, <span>nil</span></td></tr><tr><td id="file-keptn_client_implementation-go-L66" data-line-number="66"></td><td id="file-keptn_client_implementation-go-LC66">}</td></tr></tbody></table>

‍ To summaries above example, `Events` method accepts context and filter request to get events based on the filtering parameters. That method can return slice of Events or an error. Now that we have a client, let's implement the core of our plugin to call this Keptn client implementation.

Keptn Plugin Core
-----------------

In order to write a source plugin, we need to implement following contracts

‍ `Stream` is a gRPC endpoint that is consumed by a gRPC client in Botkube core. So, Botkube will stream events from this endpoint. `Metadata` is used for providing information about Keptn plugin. This will be also used by CI system to generate plugin metadata. Metadata can contain plugin configuration details.

In `Stream` method, we need to consume Keptn events as follows.

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="Go" data-tagsearch-path="keptn_consume_events.go"><tbody><tr><td id="file-keptn_consume_events-go-L1" data-line-number="1"></td><td id="file-keptn_consume_events-go-LC1"><span>// source.go</span></td></tr><tr><td id="file-keptn_consume_events-go-L2" data-line-number="2"></td><td id="file-keptn_consume_events-go-LC2"><span>package</span> keptn</td></tr><tr><td id="file-keptn_consume_events-go-L3" data-line-number="3"></td><td id="file-keptn_consume_events-go-LC3"><span>const</span> <span>pollPeriodInSeconds</span> <span>=</span> <span>5</span></td></tr><tr><td id="file-keptn_consume_events-go-L4" data-line-number="4"></td><td id="file-keptn_consume_events-go-LC4"><span>...</span></td></tr><tr><td id="file-keptn_consume_events-go-L5" data-line-number="5"></td><td id="file-keptn_consume_events-go-LC5"><span>func</span> (<span>p</span> <span>*</span><span>Source</span>) <span>consumeEvents</span>(<span>ctx</span> context.<span>Context</span>, <span>cfg</span> <span>Config</span>, <span>ch</span> <span>chan</span><span>&lt;-</span> source.<span>Event</span>) {</td></tr><tr><td id="file-keptn_consume_events-go-L6" data-line-number="6"></td><td id="file-keptn_consume_events-go-LC6"><span>keptn</span>, <span>err</span> <span>:=</span> <span>NewClient</span>(<span>cfg</span>.<span>URL</span>, <span>cfg</span>.<span>Token</span>)</td></tr><tr><td id="file-keptn_consume_events-go-L7" data-line-number="7"></td><td id="file-keptn_consume_events-go-LC7"><span>log</span> <span>:=</span> <span>loggerx</span>.<span>New</span>(<span>cfg</span>.<span>Log</span>)</td></tr><tr><td id="file-keptn_consume_events-go-L8" data-line-number="8"></td><td id="file-keptn_consume_events-go-LC8"><span>exitOnError</span>(<span>err</span>, <span>log</span>)</td></tr><tr><td id="file-keptn_consume_events-go-L9" data-line-number="9"></td><td id="file-keptn_consume_events-go-LC9"><span>for</span> {</td></tr><tr><td id="file-keptn_consume_events-go-L10" data-line-number="10"></td><td id="file-keptn_consume_events-go-LC10"><span>req</span> <span>:=</span> <span>GetEventsRequest</span>{</td></tr><tr><td id="file-keptn_consume_events-go-L11" data-line-number="11"></td><td id="file-keptn_consume_events-go-LC11"><span>Project</span>: <span>cfg</span>.<span>Project</span>,</td></tr><tr><td id="file-keptn_consume_events-go-L12" data-line-number="12"></td><td id="file-keptn_consume_events-go-LC12"><span>FromTime</span>: <span>time</span>.<span>Now</span>().<span>Add</span>(<span>-</span><span>time</span>.<span>Second</span> <span>*</span> <span>pollPeriodInSeconds</span>),</td></tr><tr><td id="file-keptn_consume_events-go-L13" data-line-number="13"></td><td id="file-keptn_consume_events-go-LC13">}</td></tr><tr><td id="file-keptn_consume_events-go-L14" data-line-number="14"></td><td id="file-keptn_consume_events-go-LC14"><span>res</span>, <span>err</span> <span>:=</span> <span>keptn</span>.<span>Events</span>(<span>ctx</span>, <span>&amp;</span><span>req</span>)</td></tr><tr><td id="file-keptn_consume_events-go-L15" data-line-number="15"></td><td id="file-keptn_consume_events-go-LC15"><span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {</td></tr><tr><td id="file-keptn_consume_events-go-L16" data-line-number="16"></td><td id="file-keptn_consume_events-go-LC16"><span>log</span>.<span>Errorf</span>(<span>"failed to get events. %v"</span>, <span>err</span>)</td></tr><tr><td id="file-keptn_consume_events-go-L17" data-line-number="17"></td><td id="file-keptn_consume_events-go-LC17">}</td></tr><tr><td id="file-keptn_consume_events-go-L18" data-line-number="18"></td><td id="file-keptn_consume_events-go-LC18"><span>for</span> <span>_</span>, <span>event</span> <span>:=</span> <span>range</span> <span>res</span> {</td></tr><tr><td id="file-keptn_consume_events-go-L19" data-line-number="19"></td><td id="file-keptn_consume_events-go-LC19"><span>textFields</span> <span>:=</span> []api.<span>TextField</span>{</td></tr><tr><td id="file-keptn_consume_events-go-L20" data-line-number="20"></td><td id="file-keptn_consume_events-go-LC20">{<span>Key</span>: <span>"Source"</span>, <span>Value</span>: <span>PluginName</span>},</td></tr><tr><td id="file-keptn_consume_events-go-L21" data-line-number="21"></td><td id="file-keptn_consume_events-go-LC21">{<span>Key</span>: <span>"Type"</span>, <span>Value</span>: <span>event</span>.<span>Type</span>},</td></tr><tr><td id="file-keptn_consume_events-go-L22" data-line-number="22"></td><td id="file-keptn_consume_events-go-LC22">}</td></tr><tr><td id="file-keptn_consume_events-go-L23" data-line-number="23"></td><td id="file-keptn_consume_events-go-LC23"><span>if</span> <span>event</span>.<span>Data</span>.<span>Status</span> <span>!=</span> <span>""</span> {</td></tr><tr><td id="file-keptn_consume_events-go-L24" data-line-number="24"></td><td id="file-keptn_consume_events-go-LC24"><span>textFields</span> <span>=</span> <span>append</span>(<span>textFields</span>, api.<span>TextField</span>{<span>Key</span>: <span>"State"</span>, <span>Value</span>: <span>event</span>.<span>Data</span>.<span>Status</span>})</td></tr><tr><td id="file-keptn_consume_events-go-L25" data-line-number="25"></td><td id="file-keptn_consume_events-go-LC25">}</td></tr><tr><td id="file-keptn_consume_events-go-L26" data-line-number="26"></td><td id="file-keptn_consume_events-go-LC26"><span>var</span> <span>bulletLists</span> []api.<span>BulletList</span></td></tr><tr><td id="file-keptn_consume_events-go-L27" data-line-number="27"></td><td id="file-keptn_consume_events-go-LC27"><span>if</span> <span>event</span>.<span>Data</span>.<span>Message</span> <span>!=</span> <span>""</span> {</td></tr><tr><td id="file-keptn_consume_events-go-L28" data-line-number="28"></td><td id="file-keptn_consume_events-go-LC28"><span>bulletLists</span> <span>=</span> []api.<span>BulletList</span>{</td></tr><tr><td id="file-keptn_consume_events-go-L29" data-line-number="29"></td><td id="file-keptn_consume_events-go-LC29">{</td></tr><tr><td id="file-keptn_consume_events-go-L30" data-line-number="30"></td><td id="file-keptn_consume_events-go-LC30"><span>Title</span>: <span>"Description"</span>,</td></tr><tr><td id="file-keptn_consume_events-go-L31" data-line-number="31"></td><td id="file-keptn_consume_events-go-LC31"><span>Items</span>: []<span>string</span>{</td></tr><tr><td id="file-keptn_consume_events-go-L32" data-line-number="32"></td><td id="file-keptn_consume_events-go-LC32"><span>event</span>.<span>Data</span>.<span>Message</span>,</td></tr><tr><td id="file-keptn_consume_events-go-L33" data-line-number="33"></td><td id="file-keptn_consume_events-go-LC33">},</td></tr><tr><td id="file-keptn_consume_events-go-L34" data-line-number="34"></td><td id="file-keptn_consume_events-go-LC34">},</td></tr><tr><td id="file-keptn_consume_events-go-L35" data-line-number="35"></td><td id="file-keptn_consume_events-go-LC35">}</td></tr><tr><td id="file-keptn_consume_events-go-L36" data-line-number="36"></td><td id="file-keptn_consume_events-go-LC36">}</td></tr><tr><td id="file-keptn_consume_events-go-L37" data-line-number="37"></td><td id="file-keptn_consume_events-go-LC37"><span>msg</span> <span>:=</span> api.<span>Message</span>{</td></tr><tr><td id="file-keptn_consume_events-go-L38" data-line-number="38"></td><td id="file-keptn_consume_events-go-LC38"><span>Type</span>: <span>api</span>.<span>NonInteractiveSingleSection</span>,</td></tr><tr><td id="file-keptn_consume_events-go-L39" data-line-number="39"></td><td id="file-keptn_consume_events-go-LC39"><span>Timestamp</span>: <span>time</span>.<span>Now</span>(),</td></tr><tr><td id="file-keptn_consume_events-go-L40" data-line-number="40"></td><td id="file-keptn_consume_events-go-LC40"><span>Sections</span>: []api.<span>Section</span>{</td></tr><tr><td id="file-keptn_consume_events-go-L41" data-line-number="41"></td><td id="file-keptn_consume_events-go-LC41">{</td></tr><tr><td id="file-keptn_consume_events-go-L42" data-line-number="42"></td><td id="file-keptn_consume_events-go-LC42"><span>TextFields</span>: <span>textFields</span>,</td></tr><tr><td id="file-keptn_consume_events-go-L43" data-line-number="43"></td><td id="file-keptn_consume_events-go-LC43"><span>BulletLists</span>: <span>bulletLists</span>,</td></tr><tr><td id="file-keptn_consume_events-go-L44" data-line-number="44"></td><td id="file-keptn_consume_events-go-LC44">},</td></tr><tr><td id="file-keptn_consume_events-go-L45" data-line-number="45"></td><td id="file-keptn_consume_events-go-LC45">},</td></tr><tr><td id="file-keptn_consume_events-go-L46" data-line-number="46"></td><td id="file-keptn_consume_events-go-LC46">}</td></tr><tr><td id="file-keptn_consume_events-go-L47" data-line-number="47"></td><td id="file-keptn_consume_events-go-LC47"><span>ch</span> <span>&lt;-</span> source.<span>Event</span>{</td></tr><tr><td id="file-keptn_consume_events-go-L48" data-line-number="48"></td><td id="file-keptn_consume_events-go-LC48"><span>Message</span>: <span>msg</span>,</td></tr><tr><td id="file-keptn_consume_events-go-L49" data-line-number="49"></td><td id="file-keptn_consume_events-go-LC49"><span>RawObject</span>: <span>event</span>,</td></tr><tr><td id="file-keptn_consume_events-go-L50" data-line-number="50"></td><td id="file-keptn_consume_events-go-LC50">}</td></tr><tr><td id="file-keptn_consume_events-go-L51" data-line-number="51"></td><td id="file-keptn_consume_events-go-LC51">}</td></tr><tr><td id="file-keptn_consume_events-go-L52" data-line-number="52"></td><td id="file-keptn_consume_events-go-LC52"><span>// Fetch events periodically with given frequency</span></td></tr><tr><td id="file-keptn_consume_events-go-L53" data-line-number="53"></td><td id="file-keptn_consume_events-go-LC53"><span>time</span>.<span>Sleep</span>(<span>time</span>.<span>Second</span> <span>*</span> <span>pollPeriodInSeconds</span>)</td></tr><tr><td id="file-keptn_consume_events-go-L54" data-line-number="54"></td><td id="file-keptn_consume_events-go-LC54">}</td></tr><tr><td id="file-keptn_consume_events-go-L55" data-line-number="55"></td><td id="file-keptn_consume_events-go-LC55">}</td></tr><tr><td id="file-keptn_consume_events-go-L56" data-line-number="56"></td><td id="file-keptn_consume_events-go-LC56"><span>...</span></td></tr></tbody></table>

‍ Above implementation will poll Keptn endpoint each for 5 seconds and will return a Message to Botkube so that it will dispatch this message to configured platform. Notice, we use `FromTime` parameter to fetch only last 5 seconds windowed events. As you also noticed, we use a special struct `api.Message` for structured message that you can see advanced details about that [here](https://docs.botkube.io/plugin/interactive-messages).

Building Plugin
---------------

In order to build plugin, you can use following command.

‍ This will build the plugin, and generate a metadata file for plugin index. `PLUGIN_DOWNLOAD_URL_BASE_PATH` environment variable is used for defining the base path of plugin download url. Now we have plugin binaries locally, then we can serve them with following command.

‍ Once you navigate to http://localhost:8080/dist, you can see the keptn plugin binary. This means, Botkube core can consume this endpoint to donwload and register as Botkube plugin.

Running Botkube
---------------

In order to use the Keptn plugin, we can use following repository config in Botkube configuration file.

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="YAML" data-tagsearch-path="botkube_repo_config.yaml"><tbody><tr><td id="file-botkube_repo_config-yaml-L1" data-line-number="1"></td><td id="file-botkube_repo_config-yaml-LC1"><span>// config.yaml</span></td></tr><tr><td id="file-botkube_repo_config-yaml-L2" data-line-number="2"></td><td id="file-botkube_repo_config-yaml-LC2">...</td></tr><tr><td id="file-botkube_repo_config-yaml-L3" data-line-number="3"></td><td id="file-botkube_repo_config-yaml-LC3"><span>plugins</span>:</td></tr><tr><td id="file-botkube_repo_config-yaml-L4" data-line-number="4"></td><td id="file-botkube_repo_config-yaml-LC4"><span>repositories</span>:</td></tr><tr><td id="file-botkube_repo_config-yaml-L5" data-line-number="5"></td><td id="file-botkube_repo_config-yaml-LC5"><span>botkube</span>:</td></tr><tr><td id="file-botkube_repo_config-yaml-L6" data-line-number="6"></td><td id="file-botkube_repo_config-yaml-LC6"><span>url</span>: <span>http://localhost:8080/plugins-dev-index.yaml</span></td></tr><tr><td id="file-botkube_repo_config-yaml-L7" data-line-number="7"></td><td id="file-botkube_repo_config-yaml-LC7">...</td></tr></tbody></table>

‍ The above config is just for making Keptn plugin visible to Botkube core, now we can add a Keptn source plugin configuration as follows.

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="YAML" data-tagsearch-path="keptn_plugin_source_configuration.yaml"><tbody><tr><td id="file-keptn_plugin_source_configuration-yaml-L1" data-line-number="1"></td><td id="file-keptn_plugin_source_configuration-yaml-LC1"><span><span>'</span><span>keptn</span><span>'</span></span>:</td></tr><tr><td id="file-keptn_plugin_source_configuration-yaml-L2" data-line-number="2"></td><td id="file-keptn_plugin_source_configuration-yaml-LC2"><span><span>#</span># Keptn source configuration</span></td></tr><tr><td id="file-keptn_plugin_source_configuration-yaml-L3" data-line-number="3"></td><td id="file-keptn_plugin_source_configuration-yaml-LC3"><span><span>#</span># Plugin name syntax: <repo>/<plugin>[@<version>]. If version is not provided, the latest version from repository is used.</version></plugin></repo></span></td></tr><tr><td id="file-keptn_plugin_source_configuration-yaml-L4" data-line-number="4"></td><td id="file-keptn_plugin_source_configuration-yaml-LC4"><span>botkube/keptn</span>:</td></tr><tr><td id="file-keptn_plugin_source_configuration-yaml-L5" data-line-number="5"></td><td id="file-keptn_plugin_source_configuration-yaml-LC5"><span><span>#</span> -- If true, enables `keptn` source.</span></td></tr><tr><td id="file-keptn_plugin_source_configuration-yaml-L6" data-line-number="6"></td><td id="file-keptn_plugin_source_configuration-yaml-LC6"><span>enabled</span>: <span>true</span></td></tr><tr><td id="file-keptn_plugin_source_configuration-yaml-L7" data-line-number="7"></td><td id="file-keptn_plugin_source_configuration-yaml-LC7"><span>config</span>:</td></tr><tr><td id="file-keptn_plugin_source_configuration-yaml-L8" data-line-number="8"></td><td id="file-keptn_plugin_source_configuration-yaml-LC8"><span>project</span>: <span><span>"</span>botkube<span>"</span></span></td></tr><tr><td id="file-keptn_plugin_source_configuration-yaml-L9" data-line-number="9"></td><td id="file-keptn_plugin_source_configuration-yaml-LC9"><span>url</span>: <span><span>"</span>http://localhost:8080/api<span>"</span></span></td></tr><tr><td id="file-keptn_plugin_source_configuration-yaml-L10" data-line-number="10"></td><td id="file-keptn_plugin_source_configuration-yaml-LC10"><span>token</span>: <span><span>"</span>keptn_token<span>"</span></span></td></tr><tr><td id="file-keptn_plugin_source_configuration-yaml-L11" data-line-number="11"></td><td id="file-keptn_plugin_source_configuration-yaml-LC11"><span>log</span>:</td></tr><tr><td id="file-keptn_plugin_source_configuration-yaml-L12" data-line-number="12"></td><td id="file-keptn_plugin_source_configuration-yaml-LC12"><span>level</span>: <span>info</span></td></tr></tbody></table>

‍ All the Keptn configurations are defined under `config` section. Once Botkube application starts, it would stream Keptn plugin and that plugin consume the endpoint `http://localhost:8080/api` with query parameters `project=botkube` and with auth headers `X-Token=<keptn_token>`. However, we need to add this Keptn source to `communications` configuration of Botkube as follows.

<table data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="YAML" data-tagsearch-path="keptn_plugin_comm_config.yaml"><tbody><tr><td id="file-keptn_plugin_comm_config-yaml-L1" data-line-number="1"></td><td id="file-keptn_plugin_comm_config-yaml-LC1">...</td></tr><tr><td id="file-keptn_plugin_comm_config-yaml-L2" data-line-number="2"></td><td id="file-keptn_plugin_comm_config-yaml-LC2"><span>slack</span>:</td></tr><tr><td id="file-keptn_plugin_comm_config-yaml-L3" data-line-number="3"></td><td id="file-keptn_plugin_comm_config-yaml-LC3"><span>enabled</span>: <span>true</span></td></tr><tr><td id="file-keptn_plugin_comm_config-yaml-L4" data-line-number="4"></td><td id="file-keptn_plugin_comm_config-yaml-LC4"><span>token</span>: <span><span>"</span>xoxb-...<span>"</span></span></td></tr><tr><td id="file-keptn_plugin_comm_config-yaml-L5" data-line-number="5"></td><td id="file-keptn_plugin_comm_config-yaml-LC5"><span>channels</span>:</td></tr><tr><td id="file-keptn_plugin_comm_config-yaml-L6" data-line-number="6"></td><td id="file-keptn_plugin_comm_config-yaml-LC6"><span><span>'</span><span>default</span><span>'</span></span>:</td></tr><tr><td id="file-keptn_plugin_comm_config-yaml-L7" data-line-number="7"></td><td id="file-keptn_plugin_comm_config-yaml-LC7"><span>name</span>: <span>botkube-demo</span></td></tr><tr><td id="file-keptn_plugin_comm_config-yaml-L8" data-line-number="8"></td><td id="file-keptn_plugin_comm_config-yaml-LC8"><span>bindings</span>:</td></tr><tr><td id="file-keptn_plugin_comm_config-yaml-L9" data-line-number="9"></td><td id="file-keptn_plugin_comm_config-yaml-LC9"><span>sources</span>:</td></tr><tr><td id="file-keptn_plugin_comm_config-yaml-L10" data-line-number="10"></td><td id="file-keptn_plugin_comm_config-yaml-LC10">- <span>keptn</span></td></tr><tr><td id="file-keptn_plugin_comm_config-yaml-L11" data-line-number="11"></td><td id="file-keptn_plugin_comm_config-yaml-LC11">...</td></tr></tbody></table>

‍ Whenever an event is fired in Keptn, this event will be stored in mongodb-datasource and this will be consumed by Keptn plugin. Finally, with above configuration, it will be sent to platforms which are defined in `communications` section.

![Image 6](https://assets-global.website-files.com/634fabb21508d6c9db9bc46f/646b726bb3ed5ff180fca044_keptn-slack-message.png)

Get Started with Botkube Plugin Development
-------------------------------------------

We hope that this helps you get started with developing your own Botkube plugin! If you need some help or have any questions, we're always available on the [Botkube Community Slack](https://join.botkube.io/). Check out the [Botkube Plugin Development Quick Start](https://docs.botkube.io/plugin/quick-start) and [Implementing Custom Botkube Source Plugin](https://docs.botkube.io/plugin/custom-source) guides to help you along the way.
